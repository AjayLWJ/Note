## TCP/IP 基础知识

​		TCP/IP 只是利用 IP 进行通信时所必须用到的协议群的统称。具体来说，IP 或 ICMP、TCP 或 UDP、TELNET 或 FTP、以及 HTTP 等都属于 TCP/IP 的协议。

![TCP_IP协议群](.\image\TCP_IP协议群.png)

​		TCP/IP 的协议的标准化过程与其他的标准化过程有所不同，具有两大特点：一是具有开放性，二是注重实用性，即被标准化的协议能否被实际运用。

​		互联网进行通信时，需要相应的网络协议，TCP/IP 原本就是为使用互联网而开发制定的协议族。因此，互联网的协议就是 TCP/IP，TCP/IP 就是互联网的协议。

### 1、TCP/IP 协议分层模型

#### 1.1 TCP/IP 与 OSI 参考模型

![OSI参考模型与TCP_IP的关系](.\image\OSI参考模型与TCP_IP的关系.png)

​		从上图看出，OSI 参考模型注重 “通信协议必要的功能是什么”，而 TCP/IP 则更强调 “在计算机上实现协议应该开发哪种程序”。

##### 【硬件】—— 物理层

​		TCP/IP 的最底层是负责数据传输的硬件，这种硬件就相当于以太网或电话线路等物理层的设备。

##### 【网络接口层】—— 数据链路层

​		网络接口层利用以太网中的数据链路层进行通信，因此属于接口层。也就是说，把它当做让 NIC 起作用的 “驱动程序” 也无妨，其中驱动程序是在操作系统与硬件之间起桥梁作用的软件。

##### 【互联网层】—— 网络层

​		互联网层使用 IP 协议，它相当于 OSI 模型中的第三层网络层。IP 协议基于 IP 地址转发分包数据。

![互联网层](.\image\互联网层.png)

​		TCP/IP 分层中 **互联网层与传输层** 的功能通常由 **操作系统** 提供。尤其是路由器，它必须得实现通过互联网层转发分组数据包的功能。此外，连接互联网的所有主机跟路由器必须都实现 IP 的功能。

- IP

​		**IP** 是 **跨越网络传送数据包，使整个互联网都能收到数据的协议**。IP 协议使数据能够发送到地球的另一端，这期间它使用 IP 地址作为主机的标识。

​		IP 还隐含着数据链路层的功能，通过 IP，相互通信的主机之间无论经过怎样的底层数据链路都能实现通信。

​		虽然 IP 也是分组交换的一种协议，但是它不具有重发机制，即使分组数据包未能到达对端主机也不会重发，属于 **非可靠性传输协议**。

- ICMP

​		IP 数据包在发送途中一旦 **发生异常导致无法到达对端目标地址** 时，需要给发送端发送一个 **发生异常的通知**。ICMP 就是为这一功能而制定的，有时也被用来诊断网络的健康状况。

- ARP

​		从分组数据包的 IP 地址中 **解析出物理地址 (MAC 地址) 的一种协议**。

##### 【传输层】

​		TCP/IP 的传输层有两个具有代表性的协议。

![传输层](.\image\传输层.png)

​		传输层最主要的 **功能** 是 **能够让应用程序之间实现通信**。

- TCP

​		TCP 是一种 **面向有连接的传输层协议**，它可以保证两端通信主机之间的通信可达。TCP 能够正确处理在传输过程中丢包、传输顺序乱掉等异常情况。此外，TCP 还能有效利用贷款，缓解网络拥堵。

​		然而，为了建立与断开连接，有时它需要至少 7 次的发包收包，导致网络流量的浪费。

- UCP

​		它是一种 **面向无连接的传输层协议**。UDP 不会关注对端是否真的收到了传送过去的数据，常用于分组数据较少或多播、广播通信以及视频通信等多媒体领域。

##### 【应用层】—— 会话层以上的分层

​		TCP/IP 的分层中，将 OSI 参考模型中的会话层、表示层和应用层的功能都集中到了应用程序中实现。这些功能有时由一个单一的程序实现，有时也可能会由多个程序实现。

​		TCP/IP 应用的架构绝大多数属于客户端/服务端模型。提供服务的程序叫 **服务端**，接收服务的程序叫 **客户端**。在这种通信模式中，**提供服务的程序预先被部署到主机上，等待接收任何时刻客户可能发送的请求**。

​		**浏览器与服务端之间通信所用的协议是 HTTP，所传输数据的主要格式是 HTML**。WWW 中的 HTTP 属于 **OSI 应用层的协议**，而 HTML 属于**表示层的协议**。

​		**发送电子邮件时用到的协议叫做 SMTP** (Simple Mail Tranfer Protocol)。而现在电子邮件的格式由 MIME 协议扩展以后，可以发送声音、图像等各式各样的信息，这里提到的 **MIME 属于 OSI 参考模型的第 6 层——表示层**。

​		**文件传输** 是指 **将保存在其他计算机硬盘上的文件转移到本地的硬盘上，或将本地硬盘的文件传送到其他机器硬盘上的意思**。这个过程使用的协议叫做 **FTP** (File Transfer Prototol)，FTP 传输过程中可以选择用二进制方式还是文本方式。在 FTP 中进行文件传输时会**建立两个 TCP 连接**，分别是发出传输请求时所要用到的 **控制连接** 与实际传输数据时所要用到的 **数据连接**。

​		**远程登录** 是指 **登录到远程的计算机上，使那台计算机上的程序得以运行的一种功能。** TCP/IP 网络中远程登录常用 TELNET 和 SSH 两种协议。

​		在 TCP/IP 中进行 **网络管理** 时，采用 **SNMP 协议**。使用 SNMP 管理的主机、网桥、路由器等称作 SNMP 代理，而进行管理的那一段叫做管理器。在 SNMP 的代理端，保存着网络接口的信息、通信数据量、异常数据量以及设备温度等信息，这些信息可以通过 **MIB** 访问。**在 TCP/IP 的网络管理中，SNMP 属于应用协议，MIB 属于表示层协议。**

### 2、TCP/IP 分层模型与通信示例

​		每个分层中，都会对所发送的数据附加一个首部，在这个首部中包含了改层必要的信息，如发送的目标地址以及协议相关信息。通常，为协议提供的信息为 **包首部**，所要发送的内容为 **数据**。

![数据包首部的层次化](.\image\数据包首部的层次化.png)

​		上图中，在下一层的角度看，从上一层收到的包全部都被认为是本层的数据。

#### 2.1 经过数据链路的包

​		分组数据包经过以太网的数据链路时的大致流程如下图所示，但下图对各个包首部做了简化。

![分层中包的结构](D:\学习资料\学习笔记\图解TCP_IP\image\分层中包的结构.png)

​		每个包首部中至少都会包两个信息：一个是 **发送端和接收端地址**，另一个是 **上一层的协议类型**。

​		经过每个协议分层时，都必须有识别发送端和接收端的信息。以太网会用 MAC 地址，IP 会用 IP 地址，而 TCP/UDP 则会用端口号作为识别两端主机的地址。

​		每个分层的包首部中还包含一个识别位，它是用来标识上一层协议的种类信息。如以太网的包首部中的以太网类型，IP 中的协议类型以及 TCP/UDP 中两个端口的端口号等都起着识别协议类型的作用。





P89